# Storyweave Web（故事讲述网页 APP）

一个**即开即用**的故事讲述网页应用，支持通过左划/点击翻页来播放由**文字、图片、视频**组成的故事；支持**PC / 手机画布比例切换**、**自动播放与间隔设置**、**创作者编辑页面**，并对图片和视频进行懒加载。

## 使用方式

### 启动服务器

1. **安装依赖**
   ```bash
   npm install
   ```

2. **启动服务器**
   ```bash
   npm start
   ```

3. **访问应用**
   - 打开浏览器访问：`http://localhost:3000`
   - 服务器会自动：
     - 提供前端页面服务
     - 提供 API 接口（读取/保存故事数据、上传媒体文件）
     - 提供 `materials` 文件夹的静态服务

### 功能说明

- **无需选择目录**：所有文件操作通过后端 API 完成，无需用户手动选择目录
- **自动保存**：编辑内容后自动保存到服务器的 `materials` 文件夹
- **即开即用**：启动服务器后即可开始使用

## 功能说明

- **左右滑动 / 点击翻页**
  - 在 PC 上：点击左右两侧箭头，或使用键盘方向键 `←` / `→`。
  - 在手机 / 触屏设备上：在故事画面区域**左划/右划**切换页面。

- **页面内容类型**
  - 文字：支持多段文本，自动换行、滚动。
  - 图片：支持两种方式：
    - **URL 方式**：输入图片 URL（网络地址），自动按画布比例缩放，采用懒加载。
    - **本地文件方式**：选择本地图片文件，文件会保存到 `materials` 文件夹，使用静态路径访问。
  - 视频：支持两种方式：
    - **URL 方式**：输入视频 URL（MP4 为主），支持播放控制，懒加载 `metadata`。
    - **本地文件方式**：选择本地视频文件，文件会保存到 `materials` 文件夹，使用静态路径访问。

- **画布比例切换**
  - 顶部可选择：
    - `PC 比例`：16:9 横屏。
    - `手机比例`：9:16 竖屏。

- **自动播放与间隔**
  - 可勾选“自动播放”，设置“每 N 秒翻页”。
  - 每个页面可以单独设置「本页停留时间（秒）」；若未设置，则使用全局间隔。
  - 自动播放时，顶部会显示一个进度条样式的**页面指示**动画。

- **故事编辑器（右侧面板）**
  - 选择页面类型（文字 / 图片 / 视频）。
  - 根据类型填写文字内容或图片/视频 URL。
  - 可设置当前页的停留时间（秒，选填）。
  - 操作：
    - `添加页面`：在故事末尾追加一页，并跳转到该页。
    - `替换当前页`：用当前表单内容覆盖当前页面。
    - `删除当前页`：删除当前页面，并跳到相邻页面。
  - 下方“页面列表”可快速查看所有页面，并点击跳转到指定页面。

## 懒加载策略

- **图片**
  - 使用 `loading="lazy"`，并只在当前页面渲染对应 `<img>` 元素。
  - 同时在 JS 中预加载下一页图片，以获得更顺畅的体验。

- **视频**
  - 仅在当前页面渲染 `<video>` 元素，使用 `preload="metadata"`。
  - 下一页的视频仅通过创建临时元素预加载元数据，不会自动开始播放。

## 后端 API

服务器提供以下 API 接口：

- `GET /api/story` - 读取故事数据（从 `materials/story.json`）
- `POST /api/story` - 保存故事数据（保存到 `materials/story.json`）
- `POST /api/upload` - 上传媒体文件（保存到 `materials` 文件夹）

## 媒体文件管理

- **materials 文件夹**
  - 所有通过"选择本地文件"上传的媒体文件都会自动保存到项目根目录下的 `materials` 文件夹。
  - 这些文件通过静态服务路径访问（如 `/materials/filename.jpg`）。
  - 文件会自动保存，无需用户手动操作。

- **story.json**
  - 故事数据保存在 `materials/story.json` 文件中。
  - 应用启动时自动读取，编辑后自动保存。
  - 无需手动导入/导出。

## 自定义与扩展建议

- 可将故事数据结构保存到本地存储或导出为 JSON，方便分享。
- 可增加“背景音乐”“全屏播放”等高级功能。
- 可增加“导入故事配置 JSON”功能，让创作者用结构化数据快速生成多篇故事。

